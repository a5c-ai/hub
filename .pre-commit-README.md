# Pre-commit Hooks Setup

This project uses [pre-commit](https://pre-commit.com/) to ensure code quality and consistency.

## What's Included

The pre-commit configuration includes the following hooks:

### General File Checks
- **Trailing whitespace removal**: Automatically removes trailing whitespace
- **End of file fixing**: Ensures files end with a newline
- **YAML validation**: Validates YAML syntax (supports multi-document files)
- **Large file prevention**: Prevents files over 1MB from being committed
- **Case conflict detection**: Detects case conflicts in filenames
- **Merge conflict detection**: Detects merge conflict markers
- **JSON validation and formatting**: Validates and auto-formats JSON files

### Go Backend Hooks
- **Go formatting**: Runs `gofmt` to format Go code
- **Go imports**: Organizes imports using `goimports`
- **Go mod tidy**: Keeps go.mod and go.sum clean
- **Go unit tests**: Runs short unit tests to catch basic issues

### Frontend Hooks (Next.js/TypeScript)
- **Prettier formatting**: Auto-formats frontend code
- **ESLint**: Lints JavaScript/TypeScript code
- **TypeScript checking**: Type-checks TypeScript files

### Security & Quality
- **Secret detection**: Scans for potential secrets using detect-secrets
- **Commit message linting**: Enforces conventional commit format

## Installation & Setup

### First Time Setup
```bash
# Install pre-commit (if not already installed)
pip install pre-commit

# Install the hooks in your local repository
pre-commit install

# Install commit message hooks
pre-commit install --hook-type commit-msg

# Install frontend dependencies
cd frontend && npm install && cd ..
```

### Running Hooks

Pre-commit hooks run automatically on `git commit`. You can also run them manually:

```bash
# Run all hooks on staged files
pre-commit run

# Run all hooks on all files
pre-commit run --all-files

# Run a specific hook
pre-commit run frontend-format

# Skip hooks for a specific commit (use sparingly)
git commit --no-verify -m "commit message"
```

## Troubleshooting

### Common Issues

1. **"goimports command not found"**
   ```bash
   go install golang.org/x/tools/cmd/goimports@latest
   ```

2. **Frontend hooks failing**
   ```bash
   cd frontend && npm install
   ```

3. **Secrets detected**
   - Review the detected secrets
   - Add false positives to `.secrets.baseline`
   - Run: `detect-secrets scan --baseline .secrets.baseline`

4. **Commit message format issues**
   - Use conventional commit format: `type(scope): description`
   - Examples: `feat: add new feature`, `fix: resolve bug`, `docs: update README`

### Updating Hooks

To update to the latest versions of hooks:
```bash
pre-commit autoupdate
```

## Configuration Files

- `.pre-commit-config.yaml`: Main pre-commit configuration
- `.secrets.baseline`: Baseline for secret detection
- `.yamllint`: YAML linting configuration
- `.commitlintrc.json`: Commit message linting rules

## Bypassing Hooks

While not recommended for regular development, you can bypass hooks in emergency situations:

```bash
# Skip pre-commit hooks
git commit --no-verify

# Skip commit-msg hooks
git commit --no-verify --no-edit
```

## IDE Integration

Most IDEs support pre-commit hooks and will show you issues before you commit. Consider installing:

- ESLint extension for your IDE
- Prettier extension for auto-formatting
- Go extension for Go formatting and linting
